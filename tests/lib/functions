#!/bin/sh

# functions for sharebox test suite

if test $1; then
    interactive=1
fi

sharebox()
{
    $PWD/../sharebox $@
}

mkfs()
{
    $PWD/../mkfs.sharebox $@
}

fuse_tester()
{
    $PWD/lib/fuse_tester $@
}

init()
{
    mkdir -p sandbox/$1/mnt sandbox/$1/fs
    mkfs sandbox/$1/fs >/dev/null
}

mount()
{
    sharebox sandbox/$1/fs sandbox/$1/mnt
}

unmount()
{
    fusermount -u -z sandbox/$1/mnt >/dev/null
}

clean()
{
    chmod -R +w sandbox
    rm -rf sandbox
}

remote_add()
{
    (cd test/$1/git && git remote add $2 ../../$2/git && cd -) >/dev/null
}

make_peers()
{
    remote_add $1 $2
    remote_add $2 $1
}

debug_interrupt()
{
    if test $interactive; then
        echo "Press enter to continue."
        read anykey
    fi
}

assert_success()
{
    ($@ 2>&1) >/dev/null || echo "Error: This failed: $@"
}

assert_fail()
{
    ($@ 2>&1) >/dev/null && echo "Error: This succeeded: $@"
}

